<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—¶å…‰èŒ¶é¦† Â· ä»£é™…äº¤æµï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰</title>
  <meta name="description" content="ç”Ÿæ´»äº¤æµåŒºã€ç»éªŒåˆ†äº«åŒºã€å­¦ä¹ äº’åŠ©åŒºã€æ•…äº‹ä¸è®°å¿†åŒºã€å…±åˆ›æ´»åŠ¨åŒºï¼›æ”¯æŒè¯­éŸ³å ä½ã€æ¯æ—¥è¯é¢˜ã€æé—®å¡ã€ç»éªŒä¹‹æ˜Ÿã€æ•™å­¦è´´ã€æ•…äº‹å½•éŸ³ã€ç§¯åˆ†/å‹‹ç« ã€å…´è¶£ç»“å¯¹ã€æ•°å­—æ•™å®¤ã€çº¿ä¸‹å®‰å…¨é¡»çŸ¥ç­‰ã€‚">
  <!-- TailwindCSS Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ï¼ˆå¯é€‰ï¼‰ä¿éšœåŠ¨æ€ç±»ååœ¨ CDN JIT ä¸‹å¯ç”¨çš„ safelistï¼ˆè¦†ç›–å¸¸ç”¨é¢œè‰²ï¼‰
    tailwind.config = {
      safelist: [
        'bg-indigo-50','bg-amber-50','bg-emerald-50','bg-violet-50','bg-sky-50','bg-yellow-50',
        'border-indigo-200','border-amber-100','border-emerald-300','border-violet-300','border-sky-300',
        'bg-indigo-600','text-white','border-indigo-600'
      ]
    }
  </script>
  <!-- React 18 UMD & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel Standalone (å…è®¸åœ¨æµè§ˆå™¨ä¸­ç›´æ¥å†™ JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Framer Motion UMDï¼ˆå¯é€‰ï¼‰ï¼Œè‹¥åŠ è½½å¤±è´¥ä¼šä½¿ç”¨é™çº§åŒ…è£… -->
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <style>
    html,body{background:#f8fafc}
  </style>
</head>
<body class="min-h-screen">
  <div id="root"></div>
  <noscript class="block p-4 text-center text-red-700">éœ€è¦æµè§ˆå™¨å¼€å¯ JavaScript æ‰èƒ½è¿è¡Œæ­¤ç•Œé¢ã€‚</noscript>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // ====== åŠ¨ç”»æ”¯æŒï¼ˆè‹¥ framer-motion UMD å­˜åœ¨åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ä¼˜é›…é™çº§ï¼‰ ======
    const FM = window['framer-motion'];
    const motion = FM ? FM.motion : new Proxy({}, { get: () => (props) => <div {...props} /> });
    const AnimatePresence = FM ? FM.AnimatePresence : ({ children }) => <>{children}</>;

    // ====== å°å›¾æ ‡ï¼šç”¨ emoji ä»£æ›¿ï¼ˆæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰ ======
    const Ico = ({ ch, className = '', label = '' }) => (
      <span role="img" aria-label={label} className={className} style={{lineHeight:1}}>{ch}</span>
    );

    const SearchIcon = (p)=> <Ico ch="ğŸ”" {...p}/>;
    const MicIcon = (p)=> <Ico ch="ğŸ™ï¸" {...p}/>;
    const StopIcon = (p)=> <Ico ch="â¹ï¸" {...p}/>;
    const ShieldIcon = (p)=> <Ico ch="ğŸ›¡ï¸" {...p}/>;
    const UsersIcon = (p)=> <Ico ch="ğŸ‘¥" {...p}/>;
    const SparklesIcon = (p)=> <Ico ch="âœ¨" {...p}/>;
    const ChevronRightIcon = (p)=> <Ico ch="â€º" {...p}/>;
    const FilterIcon = (p)=> <Ico ch="ğŸ§°" {...p}/>;
    const HeartIcon = (p)=> <Ico ch="â¤ï¸" {...p}/>;
    const BookmarkIcon = (p)=> <Ico ch="ğŸ”–" {...p}/>;
    const MessageIcon = (p)=> <Ico ch="ğŸ’¬" {...p}/>;
    const BookOpenIcon = (p)=> <Ico ch="ğŸ“˜" {...p}/>;
    const MusicIcon = (p)=> <Ico ch="ğŸµ" {...p}/>;
    const FlowerIcon = (p)=> <Ico ch="ğŸŒ¸" {...p}/>;
    const CalendarIcon = (p)=> <Ico ch="ğŸ“…" {...p}/>;

    // ====== å¸¸é‡æ•°æ® ======
    const MAIN_BOARDS = {
      'ç”Ÿæ´»äº¤æµåŒº': ['å…¨éƒ¨','æ¯æ—¥é—²èŠ','å…´è¶£è§’è½','æ€€æ—§ä¸æ–°æ½®'],
      'ç»éªŒåˆ†äº«åŒº': ['å…¨éƒ¨','èŒåœºä¸äººç”Ÿå»ºè®®','å©šæ‹ä¸å®¶åº­','ç”Ÿæ´»ç†è´¢å°å¦™æ‹›'],
      'å­¦ä¹ äº’åŠ©åŒº': ['å…¨éƒ¨','æ•°ç è¯¾å ‚','è€æ‰‹è‰ºé¦†','çŸ¥è¯†äº’åŠ©'],
      'æ•…äº‹ä¸è®°å¿†åŒº': ['å…¨éƒ¨','æˆ‘çš„å¹´ä»£','æˆé•¿æ ‘æ´','å®¶æ—è®°å¿†'],
      'å…±åˆ›æ´»åŠ¨åŒº': ['å…¨éƒ¨','è·¨ä»£å¯¹è¯å‘¨','ä¸»é¢˜å…±åˆ›','æ•°å­—äº’åŠ©æ—¥'],
    };
    const DAILY_TOPICS = [
      { text: 'ä»Šå¤©æœ€è®©ä½ å¼€å¿ƒ/çƒ¦æ¼çš„ä¸€ä»¶å°äº‹ï¼Ÿ', main:'ç”Ÿæ´»äº¤æµåŒº', sub:'æ¯æ—¥é—²èŠ' },
      { text: 'æ™’ä¸€å¼ å®¶å¸¸èœï¼Œè®²è®²èƒŒåçš„å°æ•…äº‹ã€‚', main:'ç”Ÿæ´»äº¤æµåŒº', sub:'å…´è¶£è§’è½' },
      { text: 'åˆ†äº«ä¸€é¦–è®©ä½ â€œç©¿è¶Šæ—¶ç©ºâ€çš„è€æ­Œ/æ–°æ›²ã€‚', main:'ç”Ÿæ´»äº¤æµåŒº', sub:'æ€€æ—§ä¸æ–°æ½®' },
    ];
    const needMap = { ask_guidance:'æ±‚æŒ‡å¯¼', offer_guidance:'æä¾›æŒ‡å¯¼', seek_companionship:'æ±‚é™ªä¼´', offer_companionship:'æä¾›é™ªä¼´' };

    const INIT_POSTS = [
      {id:'a1',type:'normal',main:'ç”Ÿæ´»äº¤æµåŒº',sub:'æ¯æ—¥é—²èŠ',name:'ç‹é˜¿å§¨',role:'senior',city:'ä¸Šæµ·',need:'offer_companionship',title:'æ—©å®‰ï¼Œä»Šå¤©é˜³å…‰åˆšå¥½ï¼Œä¸€èµ·äº‘æ•£æ­¥å—ï¼Ÿ',body:'æ™šä¸Š 7-8 ç‚¹å¯èŠå¤©ï¼ŒèŠèŠ±è‰ã€åšèœï¼Œä¹Ÿæ„¿æ„å¬ä½ åæ§½ã€‚',tags:['é™ªä¼´','å›­è‰º'],thanks:12,stars:4,time:'2025-10-28T19:00:00'},
      {id:'a2',type:'normal',main:'ç”Ÿæ´»äº¤æµåŒº',sub:'å…´è¶£è§’è½',name:'Cora',role:'youth',city:'ä¸Šæµ·',need:'offer_companionship',title:'åˆä¼‘è§†é¢‘é™ªå¤–å©†åƒé¥­ï¼‹è®¾ç½®å¸¸ç”¨è”ç³»äºº',body:'å¯å¸®è®¾ç½®ä¸€é”®æ‹¨å·ï¼Œæ¬¢è¿é•¿è¾ˆæ¥è¯•è¯•ã€‚',tags:['é™ªä¼´','æ•°ç '],thanks:11,stars:3,time:'2025-10-28T12:30:00'},
      {id:'a3',type:'normal',main:'ç”Ÿæ´»äº¤æµåŒº',sub:'æ€€æ—§ä¸æ–°æ½®',name:'é™ˆçˆ·çˆ·',role:'senior',city:'å—äº¬',need:'offer_companionship',title:'è€æ­Œã€Šç«¥å¹´ã€‹ï¼‹å­™å¥³æ•™çš„æ‹ç…§æ„å›¾',body:'è€ä¸æ–°ç›¸é‡ï¼Œæ¬¢è¿äº’ç›¸æ¨èæ­Œæ›²ï½',tags:['éŸ³ä¹','æ‘„å½±'],thanks:9,stars:2,time:'2025-10-20T20:10:00'},
      {id:'b1',type:'question_card',main:'ç»éªŒåˆ†äº«åŒº',sub:'èŒåœºä¸äººç”Ÿå»ºè®®',name:'ææƒ³',role:'youth',city:'æˆéƒ½',need:'ask_guidance',title:'ç¬¬ä¸€æ¬¡ä¸å¹´é•¿åŒäº‹åˆä½œï¼Œæ²Ÿé€šæœ‰æŠ€å·§å—ï¼Ÿ',body:'æ±‚ä¸å†’çŠ¯åˆé«˜æ•ˆçš„æ²Ÿé€šå»ºè®®ã€‚',tags:['èŒåœº','æ²Ÿé€š'],thanks:21,stars:8,time:'2025-10-31T09:30:00',accepted:false},
      {id:'b2',type:'normal',main:'ç»éªŒåˆ†äº«åŒº',sub:'ç”Ÿæ´»ç†è´¢å°å¦™æ‹›',name:'èµµå”',role:'senior',city:'åŒ—äº¬',need:'offer_guidance',title:'æå‰è¿˜è´·è¿˜æ˜¯æŠ•èµ„ï¼Ÿç»™å¹´è½»äººçš„å®¶åº­ç†è´¢ä¸‰æ­¥èµ°',body:'åšäº† 30 å¹´é“¶è¡Œï¼Œè°ˆé£é™©åˆ†çº§ä¸èµ„äº§é…ç½®ã€‚',tags:['ç†è´¢','å®¶åº­'],thanks:45,stars:15,time:'2025-10-25T13:00:00',expert:true},
      {id:'b3',type:'normal',main:'ç»éªŒåˆ†äº«åŒº',sub:'å©šæ‹ä¸å®¶åº­',name:'åˆ˜é˜¿å§¨',role:'senior',city:'å¦é—¨',need:'offer_guidance',title:'å©šå§»é‡Œâ€œæœ‰æ•ˆå€¾å¬â€çš„ 3 ä¸ªå°ç»ƒä¹ ',body:'ä»æƒ…ç»ªå‘½ååˆ°å¤è¿°ç¡®è®¤ï¼Œå†åˆ°å…±åŒå†³ç­–ã€‚',tags:['å©šæ‹','å®¶åº­'],thanks:28,stars:10,time:'2025-10-22T15:22:00'},
      {id:'c1',type:'lesson',main:'å­¦ä¹ äº’åŠ©åŒº',sub:'æ•°ç è¯¾å ‚',name:'Annie',role:'youth',city:'æ·±åœ³',need:'offer_guidance',title:'ç»™å¥¶å¥¶æ¢æ™ºèƒ½æœºï¼šä¸€é”®ä¸Šæ‰‹æ¸…å•ï¼ˆå›¾æ–‡ï¼‰',body:'å­—ä½“/å›¾æ ‡/å¸¸ç”¨è”ç³»äºº/è¯ˆéª—æ‹¦æˆª/è§†é¢‘é€šè¯',tags:['æ•°ç ','é€‚è€åŒ–'],thanks:26,stars:10,time:'2025-10-29T10:10:00'},
      {id:'c2',type:'lesson',main:'å­¦ä¹ äº’åŠ©åŒº',sub:'è€æ‰‹è‰ºé¦†',name:'é™ˆçˆ·çˆ·',role:'senior',city:'å—äº¬',need:'offer_guidance',title:'ç«¹ç¼–å…¥é—¨ï¼šä¸‰ç§å¸¸è§ç¼–æ³•ï¼ˆçŸ­è§†é¢‘ï¼‰',body:'å®¶åº­å®‰å…¨å¤„ç†ç«¹ç¯¾ä¸ç»ƒä¹ å»ºè®®ã€‚',tags:['æ‰‹ä½œ','éé—'],thanks:33,stars:20,time:'2025-09-18T08:30:00'},
      {id:'c3',type:'lesson',main:'å­¦ä¹ äº’åŠ©åŒº',sub:'çŸ¥è¯†äº’åŠ©',name:'Liu',role:'youth',city:'æ­å·',need:'ask_guidance',title:'AI å·¥å…·æ€ä¹ˆå¸®çˆ¶æ¯æ•´ç†å®¶åº­è´¦æœ¬ï¼Ÿ',body:'æ±‚è¡¨æ ¼æ¨¡æ¿ä¸è‡ªåŠ¨åˆ†ç±»æ€è·¯ã€‚',tags:['AI','ç†è´¢'],thanks:14,stars:5,time:'2025-10-30T09:00:00'},
      {id:'d1',type:'story_audio',main:'æ•…äº‹ä¸è®°å¿†åŒº',sub:'æˆ‘çš„å¹´ä»£',name:'å¼ è€å¸ˆ',role:'senior',city:'å¹¿å·',need:'offer_guidance',title:'é‚£å¹´æ”¯æ•™ï¼šä¸€å°æ²¡æœ‰å¯„å‡ºçš„ä¿¡ï¼ˆå½•éŸ³ï¼‰',body:'è‡ªåŠ¨è½¬å†™ç‰‡æ®µï¼šé‚£æ—¶å±±è·¯åå…«å¼¯â€¦â€¦',tags:['æ•…äº‹','æ•™è‚²'],thanks:52,stars:29,time:'2025-10-19T11:15:00',voice:true},
      {id:'d2',type:'normal',main:'æ•…äº‹ä¸è®°å¿†åŒº',sub:'å®¶æ—è®°å¿†',name:'Neo',role:'youth',city:'é•¿æ²™',need:'seek_companionship',title:'å¤–å…¬çš„é»‘ç™½ç›¸å†Œï¼Œæ¬¢è¿é•¿è¾ˆå¸®æˆ‘è¡¥å…¨åœ°å',body:'æƒ³æŠŠå®¶æ—è®°å¿†åšæˆæ—¶é—´çº¿ã€‚',tags:['è®°å¿†','ç…§ç‰‡'],thanks:17,stars:5,time:'2025-10-20T20:05:00'},
      {id:'e1',type:'activity',main:'å…±åˆ›æ´»åŠ¨åŒº',sub:'è·¨ä»£å¯¹è¯å‘¨',name:'ç¤¾ç¾¤å°åŠ©æ‰‹',role:'youth',city:'çº¿ä¸Š',need:'offer_companionship',title:'ç¬¬ 12 æœŸè·¨ä»£å¯¹è¯å‘¨ Â· æŠ¥åé…å¯¹',body:'äº’è®¿å½¼æ­¤çš„ç”Ÿæ´»æ•…äº‹ï¼Œæœ¬å‘¨å…± 20 ä¸ªé…å¯¹åé¢ã€‚',tags:['æ´»åŠ¨','é…å¯¹'],thanks:6,stars:7,time:'2025-10-30T09:00:00',joined:false},
      {id:'e2',type:'activity',main:'å…±åˆ›æ´»åŠ¨åŒº',sub:'æ•°å­—äº’åŠ©æ—¥',name:'ç¤¾ç¾¤å°åŠ©æ‰‹',role:'youth',city:'ä¸Šæµ·',need:'offer_guidance',title:'æ•°å­—äº’åŠ©æ—¥ Â· é’å¹´å¸®å¿™è®¾ç½®æ‰‹æœºæ¢ç§¯åˆ†',body:'æŠ¥åç‚¹ï¼šå¾å®¶æ±‡ç¤¾åŒºæœåŠ¡ä¸­å¿ƒï¼ˆå‘¨å…­ä¸Šåˆï¼‰',tags:['æ´»åŠ¨','çº¿ä¸‹'],thanks:3,stars:2,time:'2025-10-27T09:40:00',joined:false},
    ];

    const initials = (name)=> name.replace(/[^\u4e00-\u9fa5a-zA-Z]/g,'').slice(0,2).toUpperCase() || 'å‹';
    const fmtTime = (iso)=>{ const d=new Date(iso); const pad=(n)=> String(n).padStart(2,'0'); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}` };

    // ================= ä¸»ç»„ä»¶ =================
    function App(){
      const [activeMain, setActiveMain] = useState('ç”Ÿæ´»äº¤æµåŒº');
      const [activeSub, setActiveSub] = useState('å…¨éƒ¨');
      const [query, setQuery] = useState('');
      const [onlySenior, setOnlySenior] = useState(false);
      const [onlyYouth, setOnlyYouth] = useState(false);
      const [onlyComp, setOnlyComp] = useState(false);
      const [onlyGuide, setOnlyGuide] = useState(false);

      const [posts, setPosts] = useState(INIT_POSTS);
      const [thanked, setThanked] = useState(new Set(JSON.parse(localStorage.getItem('thanked')||'[]')));
      const [starred, setStarred] = useState(new Set(JSON.parse(localStorage.getItem('starred')||'[]')));

      const [myPoints, setMyPoints] = useState(Number(localStorage.getItem('myPoints')||0));
      const [myBadges, setMyBadges] = useState(JSON.parse(localStorage.getItem('myBadges')||'[]'));
      const [classroom, setClassroom] = useState(JSON.parse(localStorage.getItem('classroom')||'[]'));

      // æ¨¡æ€
      const [openCompose, setOpenCompose] = useState(false);
      const [openPair, setOpenPair] = useState(false);
      const [openTask, setOpenTask] = useState(false);
      const [openSafety, setOpenSafety] = useState(false);
      const [openClassroom, setOpenClassroom] = useState(false);
      const [openReport, setOpenReport] = useState(false);

      // å‘å¸–è¡¨å•
      const [form, setForm] = useState({ role:'youth', postType:'normal', main:'ç”Ÿæ´»äº¤æµåŒº', sub:'æ¯æ—¥é—²èŠ', city:'', intent:'ask_guidance', title:'', content:'', tags:'', attachments:[] });

      // è¯­éŸ³å ä½
      const [recording, setRecording] = useState(false);
      const [recordSec, setRecordSec] = useState(0);
      useEffect(()=>{ let id=null; if(recording) id=setInterval(()=> setRecordSec(s=>s+1), 1000); return ()=> id&&clearInterval(id); },[recording]);

      // ç›‘å¬è‡ªå®šä¹‰ä¸¾æŠ¥æ‰“å¼€äº‹ä»¶
      useEffect(()=>{ const fn = ()=> setOpenReport(true); window.addEventListener('open-report', fn); return ()=> window.removeEventListener('open-report', fn); },[]);

      // è¿‡æ»¤
      const filtered = useMemo(()=>{
        let list = posts.filter(p=> p.main===activeMain);
        if(activeSub!=='å…¨éƒ¨') list = list.filter(p=> p.sub===activeSub);
        const q = query.trim().toLowerCase();
        if(q){ list = list.filter(p=> p.title.toLowerCase().includes(q) || p.body.toLowerCase().includes(q) || (p.tags||[]).join(',').toLowerCase().includes(q) || (p.city||'').toLowerCase().includes(q)); }
        if(onlySenior && !onlyYouth) list = list.filter(p=> p.role==='senior');
        else if(onlyYouth && !onlySenior) list = list.filter(p=> p.role==='youth');
        if(onlyComp && !onlyGuide) list = list.filter(p=> p.need.includes('companionship') || p.sub==='æ¯æ—¥é—²èŠ');
        else if(onlyGuide && !onlyComp) list = list.filter(p=> p.need.includes('guidance') || p.type==='question_card' || p.type==='lesson');
        return list.sort((a,b)=> new Date(b.time)-new Date(a.time));
      }, [posts, activeMain, activeSub, query, onlySenior, onlyYouth, onlyComp, onlyGuide]);

      // å‹‹ç« 
      useEffect(()=>{
        const badges=[]; if(myPoints>=5) badges.push('é’æ˜¥åŠ©åŠ›'); if(myPoints>=15) badges.push('æš–å¿ƒå¯¼å¸ˆ'); if(myPoints>=30) badges.push('è·¨ä»£æ¡¥æ¢');
        setMyBadges(badges); localStorage.setItem('myPoints', String(myPoints)); localStorage.setItem('myBadges', JSON.stringify(badges));
      }, [myPoints]);

      const addPoints = (n)=> setMyPoints(p=> p+n);

      const handleAction = (id, action)=> {
        setPosts(prev=>{
          const next = prev.map(p=> ({...p}));
          const idx = next.findIndex(x=> x.id===id); if(idx===-1) return prev;
          const p = next[idx];
          if(action==='thank'){
            if(!thanked.has(id)){
              p.thanks = (p.thanks||0)+1; const t = new Set(thanked); t.add(id); setThanked(t); localStorage.setItem('thanked', JSON.stringify(Array.from(t))); addPoints(1);
            }
          }
          if(action==='star'){
            const s = new Set(starred); if(s.has(id)){ s.delete(id); p.stars=Math.max(0,(p.stars||0)-1); } else { s.add(id); p.stars=(p.stars||0)+1; addPoints(1);} setStarred(s); localStorage.setItem('starred', JSON.stringify(Array.from(s)));
          }
          if(action==='want-answer'){ alert('å·²è®°å½•ä½ æƒ³å›ç­”æ­¤æé—®å¡ï¼ˆç¤ºæ„ï¼‰ã€‚'); addPoints(1); }
          if(action==='accept'){ if(!p.accepted){ p.accepted=true; addPoints(2);} }
          if(action==='to-classroom'){
            const item = { title:p.title, summary:p.body.slice(0,120)+'â€¦', tags:p.tags||[] };
            const list = [item, ...classroom]; setClassroom(list); localStorage.setItem('classroom', JSON.stringify(list)); alert('å·²æ²‰æ·€åˆ°æ•°å­—æ•™å®¤ï¼'); addPoints(1);
          }
          if(action==='join'){ p.joined = !p.joined; if(p.joined) addPoints(1); }
          if(action==='checkin'){ alert('ç­¾åˆ°æˆåŠŸï¼ˆç¤ºæ„ï¼‰'); addPoints(1); }
          return next;
        });
      };

      const openComposePrefill = (pref={})=>{
        setForm(f=>({
          ...f,
          role: pref.role || 'youth',
          postType: pref.type || 'normal',
          main: pref.main || activeMain,
          sub: pref.sub || (MAIN_BOARDS[pref.main || activeMain]?.[1] || 'å…¨éƒ¨'),
          intent: pref.intent || 'ask_guidance',
          title: pref.title || '',
          content: pref.body || '',
          city: pref.city || '',
          tags: (pref.tags||[]).join(','),
          attachments: [],
        }));
        setOpenCompose(true);
      };

      const TopWidgets = ()=>{
        const wrapCls = 'rounded-2xl border bg-gradient-to-br from-indigo-50 to-white p-4 shadow-sm';
        const idx = (new Date().getDate()) % DAILY_TOPICS.length;
        return (
          <div className="space-y-3">
            {activeMain==='ç”Ÿæ´»äº¤æµåŒº' && (
              <div className={wrapCls}>
                <div className="flex items-center gap-2 text-indigo-700 font-semibold">ğŸŒ æ¯æ—¥è¯é¢˜å¼•å¯¼</div>
                <div className="mt-1 text-sm text-gray-700">{DAILY_TOPICS[idx].text}</div>
                <div className="mt-3 flex items-center gap-2">
                  <button className="px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-sm" onClick={()=> openComposePrefill({ main:DAILY_TOPICS[idx].main, sub:DAILY_TOPICS[idx].sub, type:'normal', role:'senior', intent:'offer_companionship', title:`ã€æ¯æ—¥è¯é¢˜ã€‘${DAILY_TOPICS[idx].text}`, body:'' })}>å†™å›åº”</button>
                  <span className="text-xs text-gray-500">ç³»ç»Ÿå‘èµ· Â· {DAILY_TOPICS[idx].sub}</span>
                </div>
              </div>
            )}

            {activeMain==='ç»éªŒåˆ†äº«åŒº' && (
              <div className="grid md:grid-cols-2 gap-3">
                <div className={wrapCls}>
                  <div className="flex items-center gap-2 text-amber-700 font-semibold">ğŸ… ç»éªŒä¹‹æ˜Ÿ</div>
                  <div className="mt-2 grid gap-2">
                    {posts.filter(p=>p.main==='ç»éªŒåˆ†äº«åŒº' && p.role==='senior').sort((a,b)=>b.thanks-a.thanks).slice(0,3).map(t=> (
                      <div key={t.id} className="rounded-xl border bg-white p-3">
                        <div className="text-sm font-medium">{t.name} <span className="ml-2 rounded-full bg-amber-50 text-amber-700 text-[11px] px-2 py-0.5">ç»éªŒä¹‹æ˜Ÿ</span></div>
                        <div className="mt-1 text-xs text-gray-500 line-clamp-1">{t.title}</div>
                        <div className="mt-1 text-[11px] text-gray-400">æ„Ÿè°¢ {t.thanks}</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className={wrapCls}>
                  <div className="flex items-center gap-2 text-fuchsia-700 font-semibold">ğŸ“ é’å¹´æé—®å¡</div>
                  <div className="mt-1 text-sm text-gray-700">é’å¹´å‘å¸ƒæé—®å¡ï¼Œé•¿è¾ˆç‚¹å‡»ã€Œæƒ³å›ç­”ã€</div>
                  <button onClick={()=> openComposePrefill({ main:'ç»éªŒåˆ†äº«åŒº', sub:'èŒåœºä¸äººç”Ÿå»ºè®®', type:'question_card', role:'youth', intent:'ask_guidance' })} className="mt-3 px-3 py-1.5 rounded-lg bg-fuchsia-600 text-white text-sm">å‘æé—®å¡</button>
                </div>
              </div>
            )}

            {activeMain==='å­¦ä¹ äº’åŠ©åŒº' && (
              <div className={wrapCls}>
                <div className="flex items-center gap-2 text-emerald-700 font-semibold">âœ¨ æ¯å‘¨äº’æ•™æŒ‘æˆ˜</div>
                <div className="mt-1 text-sm text-gray-700">æœ¬å‘¨ï¼šã€Œæˆ‘æ•™ä½ æ‹ç…§ï¼Œä½ æ•™æˆ‘ä¿®å›¾ã€</div>
                <button className="mt-3 px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-sm" onClick={()=> setOpenTask(true)}>æˆ‘æ¥å‚åŠ </button>
              </div>
            )}

            {activeMain==='æ•…äº‹ä¸è®°å¿†åŒº' && (
              <div className={wrapCls}>
                <div className="flex items-center gap-2 text-violet-700 font-semibold">ğŸ“œ æ¸©æƒ…æ•…äº‹ Top10</div>
                <div className="mt-1 text-sm text-gray-700">æ¯æœˆè¯„é€‰ Â· è‡ªåŠ¨æ±‡æ€»æ„Ÿè°¢å€¼</div>
              </div>
            )}

            {activeMain==='å…±åˆ›æ´»åŠ¨åŒº' && (
              <div className={wrapCls}>
                <div className="flex items-center gap-2 text-sky-700 font-semibold">ğŸ›¡ï¸ æ´»åŠ¨å®‰å…¨æç¤º</div>
                <div className="mt-1 text-sm text-gray-700">æŠ¥åéœ€é˜…è¯»å®‰å…¨é¡»çŸ¥å¹¶å®Œæˆç­¾åˆ°ç•™ç—•</div>
                <button className="mt-3 px-3 py-1.5 rounded-lg bg-sky-600 text-white text-sm" onClick={()=> setOpenSafety(true)}>æŸ¥çœ‹å®‰å…¨é¡»çŸ¥</button>
              </div>
            )}
          </div>
        );
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white p-6 text-gray-800">
          {/* Header */}
          <header className="mb-6 flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="relative">
                <div className="w-12 h-12 rounded-2xl bg-gradient-to-tr from-indigo-500 via-fuchsia-500 to-amber-400 grid place-items-center text-white font-bold text-lg shadow-md">æ¡¥</div>
                <div className="absolute -bottom-1 -right-1 rounded-full bg-white shadow px-2 py-0.5 text-[11px] text-gray-600">Beta</div>
              </div>
              <div>
                <h1 className="text-2xl font-semibold">æ—¶å…‰èŒ¶é¦† â€” ä»£é™…äº¤æµ</h1>
                <p className="text-sm text-gray-500">è®©é™ªä¼´ä¸ç»éªŒæµåŠ¨ Â· è®¾è®¡åŸå‹</p>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <div className="relative">
                <input className="pl-9 pr-3 py-2 rounded-xl border w-64 text-sm focus:ring-2 ring-indigo-200 outline-none" placeholder="æœç´¢è¯é¢˜/ç”¨æˆ·" value={query} onChange={(e)=>setQuery(e.target.value)} />
                <span className="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"><SearchIcon/></span>
              </div>
              <button className="px-3 py-2 rounded-xl bg-indigo-600 text-white text-sm shadow hover:brightness-110" onClick={()=> openComposePrefill({ main: activeMain, sub: MAIN_BOARDS[activeMain]?.[1] || 'å…¨éƒ¨' })}>åˆ›å»ºè¯é¢˜</button>
            </div>
          </header>

          <div className="grid grid-cols-12 gap-6">
            {/* Sidebar */}
            <aside className="col-span-12 md:col-span-3 space-y-4">
              <div className="bg-white rounded-2xl p-4 shadow-sm border">
                <nav className="flex flex-col gap-2">
                  {Object.keys(MAIN_BOARDS).map((key)=> (
                    <button key={key} onClick={()=>{ setActiveMain(key); setActiveSub('å…¨éƒ¨'); }} className={`text-left p-3 rounded-xl transition-all border ${activeMain===key ? 'bg-indigo-50 border-indigo-200 shadow-sm' : 'hover:bg-gray-50 border-gray-200'}`}>
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-sm font-medium flex items-center gap-2">
                            { key==='ç”Ÿæ´»äº¤æµåŒº' && <FlowerIcon/> }
                            { key==='ç»éªŒåˆ†äº«åŒº' && <BookOpenIcon/> }
                            { key==='å­¦ä¹ äº’åŠ©åŒº' && <SparklesIcon/> }
                            { key==='æ•…äº‹ä¸è®°å¿†åŒº' && <MusicIcon/> }
                            { key==='å…±åˆ›æ´»åŠ¨åŒº' && <CalendarIcon/> }
                            {key}
                          </div>
                          <div className="text-xs text-gray-500 mt-0.5">
                            { key==='ç”Ÿæ´»äº¤æµåŒº' && 'æ—¥å¸¸é—²èŠÂ·å…´è¶£åˆ†äº«Â·è¯­éŸ³ç•™è¨€' }
                            { key==='ç»éªŒåˆ†äº«åŒº' && 'èŒåœºä¸äººç”ŸÂ·å©šæ‹å®¶åº­Â·ç†è´¢å»ºè®®' }
                            { key==='å­¦ä¹ äº’åŠ©åŒº' && 'æ•°ç è¯¾å ‚Â·è€æ‰‹è‰ºÂ·çŸ¥è¯†äº’åŠ©' }
                            { key==='æ•…äº‹ä¸è®°å¿†åŒº' && 'å£è¿°å†å²Â·æ¸©æƒ…æ•…äº‹Â·å®¶æ—è®°å¿†' }
                            { key==='å…±åˆ›æ´»åŠ¨åŒº' && 'è·¨ä»£å¯¹è¯Â·ä¸»é¢˜å…±åˆ›Â·æ•°å­—äº’åŠ©æ—¥' }
                          </div>
                        </div>
                        <span className="text-gray-400 text-sm"><ChevronRightIcon/></span>
                      </div>
                    </button>
                  ))}
                </nav>

                <div className="mt-6 text-sm text-gray-600">
                  <div className="font-medium mb-2">ä»Šæ—¥æ´»åŠ¨</div>
                  <ul className="space-y-2">
                    <li className="p-2 rounded-lg bg-indigo-50 border border-indigo-100 text-indigo-700">æ•°å­—äº’åŠ©æ—¥ â€” 14:00</li>
                    <li className="p-2 rounded-lg bg-amber-50 border border-amber-100 text-amber-700">è·¨ä»£å¯¹è¯å‘¨æŠ¥åä¸­</li>
                  </ul>
                </div>
              </div>

              <div className="bg-white rounded-2xl p-4 shadow-sm border">
                <div className="text-sm font-medium">å…´è¶£ç»“å¯¹</div>
                <p className="text-xs text-gray-500 mt-1">æŠ€èƒ½ Ã— å…´è¶£ï¼ˆå¦‚â€œä¹¦æ³• Ã— æµ·æŠ¥è®¾è®¡â€ï¼‰</p>
                <div className="mt-3 flex gap-2">
                  <button className="px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-sm" onClick={()=> setOpenPair(true)}><UsersIcon/> ç»“å¯¹</button>
                  <button className="px-3 py-1.5 rounded-lg border text-sm" onClick={()=> setOpenTask(true)}><SparklesIcon/> æ¯å‘¨ä»»åŠ¡å¡</button>
                </div>
              </div>

              <div className="bg-white rounded-2xl p-4 shadow-sm border">
                <div className="text-sm font-medium">å¸¸ç”¨ç­›é€‰</div>
                <div className="mt-2 grid grid-cols-2 gap-2 text-sm">
                  <label className="flex items-center gap-2"><input type="checkbox" checked={onlySenior} onChange={(e)=> setOnlySenior(e.target.checked)} />åªçœ‹é•¿è¾ˆ</label>
                  <label className="flex items-center gap-2"><input type="checkbox" checked={onlyYouth} onChange={(e)=> setOnlyYouth(e.target.checked)} />åªçœ‹é’å¹´</label>
                  <label className="flex items-center gap-2"><input type="checkbox" checked={onlyComp} onChange={(e)=> setOnlyComp(e.target.checked)} />åªçœ‹é™ªä¼´</label>
                  <label className="flex items-center gap-2"><input type="checkbox" checked={onlyGuide} onChange={(e)=> setOnlyGuide(e.target.checked)} />åªçœ‹æŒ‡å¯¼</label>
                </div>
                <p className="text-xs text-gray-500 mt-3"><ShieldIcon/> çº¿ä¸‹è¯·éµå¾ªå®‰å…¨é¡»çŸ¥ï¼›ç§ä¿¡è°¨æ…äº¤æ˜“ã€‚</p>
              </div>

              <div className="bg-white rounded-2xl p-4 shadow-sm border">
                <div className="text-sm font-medium">æˆ‘çš„æˆé•¿</div>
                <div className="mt-2 flex items-center gap-2"><span className="text-xs text-gray-500">ç§¯åˆ†</span><span className="text-lg font-semibold">{myPoints}</span></div>
                <div className="mt-2 flex flex-wrap gap-2 text-xs">
                  { myBadges.length ? myBadges.map(b=> <span key={b} className="px-2 py-0.5 rounded-full bg-gray-100">{b}</span>) : <span className="text-gray-400">æš‚æ— å‹‹ç« </span> }
                </div>
              </div>
            </aside>

            {/* Main */}
            <main className="col-span-12 md:col-span-6">
              <section className="rounded-2xl border bg-white p-6 shadow-sm">
                <div className="flex items-start justify-between">
                  <div>
                    <h2 className="text-xl font-semibold">{activeMain}</h2>
                    <p className="text-sm text-gray-500">
                      { activeMain==='ç”Ÿæ´»äº¤æµåŒº' && 'æ—¥å¸¸é—²èŠÂ·å…´è¶£åˆ†äº«Â·è¯­éŸ³ç•™è¨€' }
                      { activeMain==='ç»éªŒåˆ†äº«åŒº' && 'èŒåœºä¸äººç”ŸÂ·å©šæ‹å®¶åº­Â·ç†è´¢å»ºè®®' }
                      { activeMain==='å­¦ä¹ äº’åŠ©åŒº' && 'æ•°ç è¯¾å ‚Â·è€æ‰‹è‰ºÂ·çŸ¥è¯†äº’åŠ©' }
                      { activeMain==='æ•…äº‹ä¸è®°å¿†åŒº' && 'å£è¿°å†å²Â·æ¸©æƒ…æ•…äº‹Â·å®¶æ—è®°å¿†' }
                      { activeMain==='å…±åˆ›æ´»åŠ¨åŒº' && 'è·¨ä»£å¯¹è¯Â·ä¸»é¢˜å…±åˆ›Â·æ•°å­—äº’åŠ©æ—¥' }
                    </p>
                  </div>
                  <div className="flex items-center gap-3">
                    <VoiceButton recording={recording} setRecording={setRecording} recordSec={recordSec} />
                    <button className="px-3 py-1.5 rounded-lg border text-sm"><FilterIcon/> ç­›é€‰</button>
                  </div>
                </div>

                {/* å­è¯é¢˜ */}
                <div className="mt-4 flex flex-wrap items-center gap-2">
                  {(MAIN_BOARDS[activeMain]||[]).map((sub)=> (
                    <button key={sub} onClick={()=> setActiveSub(sub)} className={`px-3 py-1.5 rounded-full text-xs border ${activeSub===sub? 'bg-indigo-600 text-white border-indigo-600':'hover:bg-gray-50'}`}>{sub}</button>
                  ))}
                </div>

                {/* é¡¶éƒ¨æŒ‚ä»¶ */}
                <div className="mt-4"><TopWidgets/></div>

                {/* å¸–å­æµ */}
                <div className="mt-6 grid gap-4">
                  <AnimatePresence mode="popLayout">
                    {filtered.map(p=> (
                      <motion.div key={p.id} initial={{opacity:0,y:6}} animate={{opacity:1,y:0}} exit={{opacity:0}} transition={{duration:.25}}>
                        <PostCard p={p} thanked={thanked} starred={starred} onAction={handleAction} />
                      </motion.div>
                    ))}
                  </AnimatePresence>

                  {!filtered.length && (
                    <div className="rounded-xl border p-6 text-sm text-gray-500 bg-gray-50">
                      æš‚æ— å†…å®¹ã€‚è¯•è¯•ä¿®æ”¹ç­›é€‰ï¼Œæˆ– <button className="text-indigo-600 underline" onClick={()=> openComposePrefill({ main:activeMain, sub:activeSub })}>å»å‘ä¸€å¸–</button>ã€‚
                    </div>
                  )}
                </div>
              </section>

              <section className="mt-6">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <InfoCard title="æ¯å‘¨ä¸»é¢˜" content="æœ¬å‘¨ï¼šæ•°ç äº’åŠ© Â· æˆ‘æ•™ä½ æ‹ç…§ï¼Œä½ æ•™æˆ‘ä¿®å›¾" />
                  <InfoCard title="çƒ­é—¨è¯é¢˜" content="æ€€æ—§éŸ³ä¹ã€å®¶åº­ç†è´¢ã€æ™ºèƒ½æ‰‹æœºå…¥é—¨" />
                  <InfoCard title="é…å¯¹æ¨è" content="ä¸ºä½ æ¨èï¼šæå¥¶å¥¶ï¼ˆä¹¦æ³•çˆ±å¥½è€…ï¼‰" />
                </div>
              </section>
            </main>

            {/* Right */}
            <aside className="col-span-12 md:col-span-3 space-y-4">
              <div className="rounded-2xl border bg-white p-4 shadow-sm">
                <h3 className="text-sm font-medium">æ–°æ‰‹æŒ‡å¼•</h3>
                <ol className="mt-3 text-sm text-gray-600 list-decimal list-inside space-y-1">
                  <li>å®Œå–„ä¸ªäººèµ„æ–™ï¼Œæ·»åŠ å…´è¶£æ ‡ç­¾</li>
                  <li>å¼€å¯è¯­éŸ³åŠŸèƒ½ï¼ˆé€‚åˆé•¿è¾ˆï¼‰</li>
                  <li>æ¯å‘¨å‚ä¸ä¸€æ¬¡äº’æ•™æ´»åŠ¨</li>
                </ol>
              </div>

              <div className="rounded-2xl border bg-white p-4 shadow-sm">
                <h3 className="text-sm font-medium">å¥–åŠ±ä¸å¾½ç« </h3>
                <div className="mt-3 flex flex-wrap gap-2 text-xs">
                  <span className="px-3 py-1 rounded-full bg-gray-100">æš–å¿ƒå¯¼å¸ˆ</span>
                  <span className="px-3 py-1 rounded-full bg-gray-100">æ•°å­—å°èƒ½æ‰‹</span>
                  <span className="px-3 py-1 rounded-full bg-gray-100">è·¨ä»£ä¹‹æ˜Ÿ</span>
                </div>
              </div>

              <div className="rounded-2xl border bg-white p-4 shadow-sm">
                <h3 className="text-sm font-medium">ç¤ºæ„å°ç»„ä»¶</h3>
                <div className="mt-3"><MiniChat sampleCount={3} /></div>
              </div>

              <div className="rounded-2xl border bg-white p-4 shadow-sm">
                <h3 className="text-sm font-medium">æ•°å­—æ•™å®¤</h3>
                <p className="text-xs text-gray-500 mt-1">é«˜èµé—®ç­”æ²‰æ·€ä¸ºç»“æ„åŒ–æ•™ç¨‹</p>
                <button className="mt-3 px-3 py-1.5 rounded-lg bg-gray-900 text-white text-sm" onClick={()=> setOpenClassroom(true)}><BookOpenIcon/> æ‰“å¼€</button>
              </div>
            </aside>
          </div>

          <footer className="mt-8 text-center text-sm text-gray-400">Â© æ—¶å…‰èŒ¶é¦† ç¤ºæ„ç•Œé¢ â€” ä»…ä¸ºåŸå‹è®¾è®¡</footer>

          {/* ===== Modals ===== */}
          <Modal open={openCompose} onClose={()=> setOpenCompose(false)} title="å‘å¸ƒå†…å®¹">
            <div className="grid gap-3">
              <div className="grid md:grid-cols-2 gap-3">
                <Field label="èº«ä»½">
                  <select className="w-full px-3 py-2 rounded-lg border" value={form.role} onChange={e=> setForm({...form, role:e.target.value})}>
                    <option value="youth">é’å¹´</option>
                    <option value="senior">é•¿è¾ˆ</option>
                  </select>
                </Field>
                <Field label="å‘å¸ƒç±»å‹">
                  <select className="w-full px-3 py-2 rounded-lg border" value={form.postType} onChange={e=> setForm({...form, postType:e.target.value})}>
                    <option value="normal">æ™®é€šå¸–å­</option>
                    <option value="question_card">æé—®å¡ï¼ˆé’å¹´ï¼‰</option>
                    <option value="lesson">æ•™å­¦è´´ï¼ˆå›¾æ–‡/çŸ­è§†é¢‘ï¼‰</option>
                    <option value="story_audio">æ•…äº‹å½•éŸ³ï¼ˆè‡ªåŠ¨è½¬å†™ï¼‰</option>
                    <option value="activity">æ´»åŠ¨ï¼ˆæŠ¥å/ç­¾åˆ°ï¼‰</option>
                  </select>
                </Field>
              </div>

              <div className="grid md:grid-cols-2 gap-3">
                <Field label="å¤§æ¿å—">
                  <select className="w-full px-3 py-2 rounded-lg border" value={form.main} onChange={e=>{ const m=e.target.value; setForm({...form, main:m, sub: MAIN_BOARDS[m][1]||'å…¨éƒ¨'}); }}>
                    {Object.keys(MAIN_BOARDS).map(k=> <option key={k}>{k}</option>)}
                  </select>
                </Field>
                <Field label="å­è¯é¢˜">
                  <select className="w-full px-3 py-2 rounded-lg border" value={form.sub} onChange={e=> setForm({...form, sub:e.target.value})}>
                    {(MAIN_BOARDS[form.main]||[]).map(s=> <option key={s}>{s}</option>)}
                  </select>
                </Field>
              </div>

              <div className="grid md:grid-cols-2 gap-3">
                <Field label="åŸå¸‚ï¼ˆé€‰å¡«ï¼‰"><input className="w-full px-3 py-2 rounded-lg border" placeholder="å¦‚ï¼šä¸Šæµ· / æˆéƒ½" value={form.city} onChange={e=> setForm({...form, city:e.target.value})} /></Field>
                <Field label="äº¤æµæ„å›¾">
                  <select className="w-full px-3 py-2 rounded-lg border" value={form.intent} onChange={e=> setForm({...form, intent:e.target.value})}>
                    <option value="ask_guidance">æ±‚æŒ‡å¯¼</option>
                    <option value="offer_guidance">æä¾›æŒ‡å¯¼</option>
                    <option value="seek_companionship">æ±‚é™ªä¼´</option>
                    <option value="offer_companionship">æä¾›é™ªä¼´</option>
                  </select>
                </Field>
              </div>

              <Field label="æ ‡é¢˜"><input className="w-full px-3 py-2 rounded-lg border" placeholder="ä¸€å¥è¯è¯´æ¸…ä½ çš„ä¸»é¢˜" value={form.title} onChange={e=> setForm({...form, title:e.target.value})} /></Field>
              <Field label="æ­£æ–‡"><textarea className="w-full px-3 py-2 rounded-lg border min-h-[120px]" placeholder="è¦èŠ/è¦æ•™/è¦é—®çš„æ˜¯ä»€ä¹ˆï¼Ÿå¸Œæœ›ä»€ä¹ˆæ—¶å€™äº¤æµï¼Ÿæ˜¯å¦å¯è¯­éŸ³/è§†é¢‘ï¼Ÿ" value={form.content} onChange={e=> setForm({...form, content:e.target.value})} /></Field>

              <div className="grid md:grid-cols-2 gap-3">
                <Field label="æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰"><input className="w-full px-3 py-2 rounded-lg border" placeholder="å¦‚ï¼šæ‰‹æœº, é˜²è¯ˆéª—, ä¹¦æ³•" value={form.tags} onChange={e=> setForm({...form, tags:e.target.value})} /></Field>
                <Field label="å›¾ç‰‡/çŸ­è§†é¢‘">
                  <label className="block">
                    <input type="file" multiple accept="image/*,video/*" className="block w-full text-sm text-gray-600 file:mr-3 file:py-1.5 file:px-3 file:rounded-lg file:border-0 file:bg-gray-900 file:text-white" onChange={(e)=> setForm({...form, attachments: Array.from(e.target.files||[])})} />
                  </label>
                  {!!form.attachments.length && (
                    <div className="mt-2 flex flex-wrap gap-2">
                      {form.attachments.map((f,i)=> <span key={i} className="px-2 py-1 bg-gray-100 rounded-md text-xs">{f.type.startsWith('video/')?'ğŸï¸':'ğŸ–¼ï¸'} {f.name}</span>)}
                    </div>
                  )}
                </Field>
              </div>

              {/* è¯­éŸ³å‘å¸ƒå ä½ */}
              <div className="rounded-xl border p-3 bg-gray-50">
                <div className="text-sm font-medium">è¯­éŸ³å‘å¸ƒï¼ˆå ä½ï¼‰</div>
                <div className="mt-2 flex items-center gap-3">
                  <button onClick={()=> setRecording(r=>!r)} type="button" className={`px-3 py-2 rounded-lg flex items-center gap-2 ${recording? 'bg-red-500 text-white':'border'}`}>
                    {recording ? <StopIcon/> : <MicIcon/>}
                    <span className="text-sm">{recording? 'åœæ­¢å½•éŸ³' : 'å¼€å§‹å½•éŸ³'}</span>
                  </button>
                  <button type="button" disabled={!recordSec} onClick={()=>{ setForm({...form, content: `${form.content}\nï¼ˆè‡ªåŠ¨è½¬å†™å ä½ï¼‰æœ¬æ®µå½•éŸ³çº¦ ${recordSec} ç§’ï¼š\n1ï¼‰â€¦â€¦\n2ï¼‰â€¦â€¦\n`}); addPoints(1); }} className={`px-3 py-2 rounded-lg text-sm ${recordSec? 'bg-indigo-600 text-white':'border text-gray-400'}`}>è‡ªåŠ¨è½¬å†™åˆ°æ­£æ–‡</button>
                  <div className="text-xs text-gray-500">{recording? `å½•åˆ¶ä¸­ ${recordSec}s` : (recordSec? `å½•éŸ³å®Œæˆ ${recordSec}s` : 'æ”¯æŒè¯­éŸ³+è½¬å†™')}</div>
                </div>
              </div>
            </div>

            <div className="mt-4 flex justify-end gap-2">
              <button className="px-3 py-2 rounded-lg border" onClick={()=> setOpenCompose(false)}>å–æ¶ˆ</button>
              <button className="px-3 py-2 rounded-lg bg-indigo-600 text-white" onClick={()=>{
                if(!form.title || !form.content){ alert('è¯·å¡«å†™æ ‡é¢˜ä¸æ­£æ–‡'); return; }
                const p = { id:'p'+Date.now(), type:form.postType, main:form.main, sub:form.sub, name: form.role==='senior'?'çƒ­å¿ƒé•¿è¾ˆ':'çƒ­å¿ƒé’å¹´', role:form.role, city:form.city||'çº¿ä¸Š', need:form.intent, title:form.title.trim(), body:form.content.trim(), tags: form.tags.split(',').map(s=>s.trim()).filter(Boolean), thanks:0, stars:0, time:new Date().toISOString(), accepted:false, expert:false, joined:false };
                setPosts(prev=> [p, ...prev]); setOpenCompose(false); addPoints(5);
              }}>å‘å¸ƒ</button>
            </div>
          </Modal>

          <Modal open={openPair} onClose={()=> setOpenPair(false)} title="å…´è¶£ç»“å¯¹">
            <div className="grid md:grid-cols-2 gap-3">
              <Field label="æˆ‘èƒ½æ•™"><input id="teach" className="w-full px-3 py-2 rounded-lg border" placeholder="å¦‚ï¼šä¹¦æ³• / æ™ºèƒ½æ‰‹æœº / æ‘„å½±æ„å›¾"/></Field>
              <Field label="æˆ‘æƒ³å­¦"><input id="learn" className="w-full px-3 py-2 rounded-lg border" placeholder="å¦‚ï¼šæµ·æŠ¥è®¾è®¡ / è§†é¢‘å‰ªè¾‘ / å¾®ä¿¡è®¾ç½®"/></Field>
            </div>
            <div className="mt-3">
              <button className="px-3 py-2 rounded-lg bg-emerald-600 text-white" onClick={()=>{
                const a = document.getElementById('teach').value.trim()||'ï¼ˆæœªå¡«ï¼‰';
                const b = document.getElementById('learn').value.trim()||'ï¼ˆæœªå¡«ï¼‰';
                alert(`æ¨èç»“å¯¹ï¼šä½ æ•™ã€${a}ã€‘ã€ä»–/å¥¹æ•™ã€${b}ã€‘ã€‚æœ¬å‘¨ä»»åŠ¡ï¼šå„å‡†å¤‡ 1 ä¸ªå°æ¼”ç¤º + 15 åˆ†é’Ÿäº’è¯„ã€‚`);
              }}>ç”Ÿæˆç»“å¯¹å»ºè®®</button>
            </div>
            <div className="mt-4 flex justify-end"><button className="px-3 py-2 rounded-lg border" onClick={()=> setOpenPair(false)}>å…³é—­</button></div>
          </Modal>

          <Modal open={openTask} onClose={()=> setOpenTask(false)} title="æ¯å‘¨äº’æ•™æŒ‘æˆ˜">
            <div className="rounded-xl border p-4 bg-emerald-50 text-emerald-900 text-sm">æœ¬å‘¨ä¸»é¢˜ï¼šã€Œæˆ‘æ•™ä½ æ‹ç…§ï¼Œä½ æ•™æˆ‘ä¿®å›¾ã€â€”â€” äº’æ¢ 30 åˆ†é’Ÿï¼Œå®Œæˆ 2 å¼ æ ·ç‰‡ä¸ 1 æ¬¡å±å¹•å…±äº«æ¼”ç¤ºã€‚</div>
            <div className="mt-4 flex justify-end gap-2">
              <button className="px-3 py-2 rounded-lg border" onClick={()=> setOpenTask(false)}>ç¨å</button>
              <button className="px-3 py-2 rounded-lg bg-emerald-600 text-white" onClick={()=>{ addPoints(1); setOpenTask(false); }}>æˆ‘æ¥å‚åŠ </button>
            </div>
          </Modal>

          <Modal open={openSafety} onClose={()=> setOpenSafety(false)} title="çº¿ä¸‹æ´»åŠ¨å®‰å…¨é¡»çŸ¥">
            <ul className="list-disc list-inside text-sm text-gray-700 space-y-1">
              <li>æ´»åŠ¨éœ€å®åæŠ¥åå¹¶è®¾ç½®ç´§æ€¥è”ç³»äººï¼›</li>
              <li>å°½é‡ç»“ä¼´å‡ºè¡Œï¼Œé€‰æ‹©å…¬å…±åœºæ‰€ï¼›</li>
              <li>ä¸éšæ„è½¬è´¦ï¼Œè°¨é˜²è¯ˆéª—ï¼›</li>
              <li>å°Šé‡å½¼æ­¤ä½œæ¯ä¸ç§°å‘¼ï¼›</li>
              <li>æ´»åŠ¨ç»“æŸè¯·å®Œæˆç­¾åˆ°ä¸å›é¡¾ã€‚</li>
            </ul>
            <div className="mt-4 flex justify-end"><button className="px-3 py-2 rounded-lg bg-sky-600 text-white" onClick={()=> setOpenSafety(false)}>çŸ¥é“äº†</button></div>
          </Modal>

          <Modal open={openClassroom} onClose={()=> setOpenClassroom(false)} title="æ•°å­—æ•™å®¤ Â· é«˜èµæ²‰æ·€">
            <div className="grid md:grid-cols-2 gap-3">
              {(classroom.length ? classroom : posts.filter(p=> (p.type==='lesson' || p.type==='normal') && (p.thanks||0)>=25).map(p=> ({title:p.title, summary:p.body.slice(0,120)+'â€¦', tags:p.tags||[]}))).map((it,idx)=> (
                <div key={idx} className="rounded-xl border p-3">
                  <div className="text-sm font-semibold">{it.title}</div>
                  <div className="mt-1 text-xs text-gray-600">{it.summary}</div>
                  <div className="mt-2 flex flex-wrap gap-2 text-[11px]">{(it.tags||[]).map((t,i)=> <span key={i} className="px-2 py-0.5 rounded-full bg-gray-100">#{t}</span>)}</div>
                </div>
              ))}
            </div>
            <div className="mt-4 flex justify-end"><button className="px-3 py-2 rounded-lg border" onClick={()=> setOpenClassroom(false)}>å…³é—­</button></div>
          </Modal>

          <Modal open={openReport} onClose={()=> setOpenReport(false)} title="ä¸¾æŠ¥å†…å®¹">
            <div className="grid gap-3">
              <Field label="åŸå› ">
                <select className="w-full px-3 py-2 rounded-lg border" id="reason">
                  <option>å¹¿å‘Š/æ°´è´´</option>
                  <option>è¾±éª‚/æ­§è§†</option>
                  <option>è¯ˆéª—/æ”¶è´¹è¯±å¯¼</option>
                  <option>å…¶å®ƒ</option>
                </select>
              </Field>
              <Field label="è¡¥å……ï¼ˆé€‰å¡«ï¼‰"><textarea className="w-full px-3 py-2 rounded-lg border min-h-[100px]" id="reasonDetail" placeholder="ç®€è¦è¯´æ˜æƒ…å†µ"/></Field>
            </div>
            <div className="mt-4 flex justify-end gap-2">
              <button className="px-3 py-2 rounded-lg border" onClick={()=> setOpenReport(false)}>å–æ¶ˆ</button>
              <button className="px-3 py-2 rounded-lg bg-gray-900 text-white" onClick={()=>{ setOpenReport(false); alert('å·²æ”¶åˆ°ä¸¾æŠ¥ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¤„ç†ã€‚æ„Ÿè°¢å®ˆæŠ¤ç¤¾åŒºã€‚'); }}>æäº¤</button>
            </div>
          </Modal>
        </div>
      );
    }

    // ===== å­ç»„ä»¶ =====
    function InfoCard({ title, content }){
      return (
        <div className="p-4 rounded-2xl border bg-white shadow-sm">
          <div className="text-sm font-semibold">{title}</div>
          <div className="mt-2 text-xs text-gray-600">{content}</div>
        </div>
      );
    }

    function MiniChat({ sampleCount=3 }){
      const samples = Array.from({ length: sampleCount }).map((_, i)=> ({ who: i%2===0 ? 'é•¿è€…':'é’å¹´', msg: i%2===0 ? 'é‚£æ—¶å€™æˆ‘ä»¬â€¦' : 'å¤ªæœ‰æ„æ€äº†ï¼Œæˆ‘æƒ³å­¦ï¼' }));
      return (
        <div className="space-y-2">
          {samples.map((s,idx)=> (
            <div key={idx} className={`p-2 rounded-lg ${s.who==='é•¿è€…' ? 'bg-amber-50 text-gray-800' : 'bg-indigo-50 text-gray-800'}`}>
              <div className="text-xs font-medium">{s.who}</div>
              <div className="text-sm">{s.msg}</div>
            </div>
          ))}
        </div>
      );
    }

    function VoiceButton({ recording, setRecording, recordSec }){
      return (
        <div className="flex items-center gap-3">
          <button onClick={()=> setRecording(r=>!r)} className={`px-3 py-2 rounded-lg flex items-center gap-2 ${recording ? 'bg-red-500 text-white' : 'border'}`}>
            {recording ? <StopIcon/> : <MicIcon/>}
            <div className="text-sm">{recording ? 'åœæ­¢å½•åˆ¶' : 'è¯­éŸ³ç•™è¨€'}</div>
          </button>
          <div className="text-xs text-gray-500">{recording ? `å½•åˆ¶ä¸­ ${recordSec}s` : 'æ”¯æŒè¯­éŸ³+è½¬å†™'}</div>
        </div>
      );
    }

    function PostCard({ p, thanked, starred, onAction }){
      const roleBadge = p.role==='senior'
        ? <span className="ml-2 text-[11px] px-2 py-0.5 rounded-full bg-fuchsia-50 text-fuchsia-700 border border-fuchsia-100">é•¿è¾ˆ</span>
        : <span className="ml-2 text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100">é’å¹´</span>;
      const typeCls = p.type==='question_card' ? 'border-amber-300 bg-amber-50' : p.type==='lesson' ? 'border-emerald-300 bg-emerald-50' : p.type==='story_audio' ? 'border-violet-300 bg-violet-50' : p.type==='activity' ? 'border-sky-300 bg-sky-50' : 'border-gray-200 bg-white';
      return (
        <article className={`rounded-2xl border ${typeCls} p-4 shadow-sm`}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-xl bg-gray-100 grid place-items-center text-sm font-semibold">{initials(p.name)}</div>
              <div>
                <div className="text-sm font-semibold">{p.name} {roleBadge}</div>
                <div className="text-xs text-gray-500">{p.title} {p.expert && <span className="ml-2 rounded-full bg-amber-100 text-amber-800 text-[11px] px-1.5">ç»éªŒä¹‹æ˜Ÿ</span>}</div>
              </div>
            </div>
            <div className="text-xs text-gray-500">Â· {p.city||'çº¿ä¸Š'} Â· {fmtTime(p.time)} Â· {p.main} / {p.sub}</div>
          </div>
          <p className="mt-3 text-sm text-gray-700">{p.body}</p>
          <div className="mt-2 flex flex-wrap gap-2 text-[11px]">
            {(p.tags||[]).map((t,i)=> <span key={i} className="px-2 py-0.5 rounded-full bg-white border">#{t}</span>)}
            <span className="ml-auto text-[11px] text-indigo-700 px-2 py-0.5 rounded-full bg-indigo-50 border border-indigo-100">{needMap[p.need]||'äº¤æµ'}</span>
          </div>
          <div className="mt-3 flex items-center gap-2">
            <button onClick={()=> onAction(p.id,'thank')} disabled={thanked.has(p.id)} className={`px-3 py-1.5 rounded-lg text-sm flex items-center gap-1 ${thanked.has(p.id)?'bg-gray-200 cursor-not-allowed':'bg-gray-900 text-white'}`}>
              <HeartIcon/> æ„Ÿè°¢ <span className="opacity-70">({p.thanks||0})</span>
            </button>
            <button onClick={()=> onAction(p.id,'star')} className={`px-3 py-1.5 rounded-lg text-sm border flex items-center gap-1 ${starred.has(p.id)?'bg-yellow-50 border-yellow-200 text-yellow-700':''}`}>
              <BookmarkIcon/> æ”¶è— <span className="opacity-60">({p.stars||0})</span>
            </button>
            <button className="px-3 py-1.5 rounded-lg text-sm border flex items-center gap-1"><MessageIcon/> ç•™è¨€</button>
            <button className="px-3 py-1.5 rounded-lg text-sm border" onClick={()=> alert('å»ºè®®ç›¸äº’å…³æ³¨åå¯ç§ä¿¡ï¼Œé™ä½éªšæ‰°é£é™©ã€‚')}>ç§ä¿¡</button>
            <button className="px-3 py-1.5 rounded-lg text-sm border" onClick={()=> alert('å·²æŠ¥åï¼ˆç¤ºæ„ï¼‰ã€‚å¦‚ä¸ºæ´»åŠ¨è´´å°†è®°å½•ä½ çš„æŠ¥åä¿¡æ¯ã€‚')}>äº’åŠ¨</button>
            <button className="px-3 py-1.5 rounded-lg text-sm border ml-auto" onClick={()=> window.dispatchEvent(new CustomEvent('open-report'))}>ä¸¾æŠ¥</button>
          </div>
          <div className="mt-2 flex flex-wrap gap-2">
            {p.type==='question_card' && (<>
              <button className="px-3 py-1.5 rounded-lg text-sm bg-amber-600 text-white" onClick={()=> onAction(p.id,'want-answer')}>æƒ³å›ç­”</button>
              <button className="px-3 py-1.5 rounded-lg text-sm border" onClick={()=> onAction(p.id,'accept')} disabled={p.accepted}>{p.accepted? 'å·²è§£å†³':'è®¾ä¸ºå·²è§£å†³'}</button>
            </>)}
            {p.type==='lesson' && (
              <button className="px-3 py-1.5 rounded-lg text-sm border" onClick={()=> onAction(p.id,'to-classroom')}>æ²‰æ·€ä¸ºæ•™ç¨‹</button>
            )}
            {p.type==='activity' && (<>
              <button className="px-3 py-1.5 rounded-lg text-sm bg-sky-600 text-white" onClick={()=> onAction(p.id,'join')}>{p.joined? 'å·²æŠ¥å':'æŠ¥åæ´»åŠ¨'}</button>
              <button className="px-3 py-1.5 rounded-lg text-sm border" onClick={()=> onAction(p.id,'checkin')}>ç­¾åˆ°</button>
            </>)}
          </div>
        </article>
      );
    }

    function Field({ label, children }){
      return (
        <label className="block">
          <div className="text-xs text-gray-600 mb-1">{label}</div>
          {children}
        </label>
      );
    }

    function Modal({ open, onClose, title, children }){
      useEffect(()=>{
        if(!open) return; const fn=(e)=>{ if(e.key==='Escape') onClose&&onClose(); }; window.addEventListener('keydown', fn); return ()=> window.removeEventListener('keydown', fn);
      }, [open]);
      if(!open) return null;
      return (
        <AnimatePresence>
          <motion.div initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} className="fixed inset-0 z-[60] bg-black/30 backdrop-blur-sm grid place-items-center p-4">
            <motion.div initial={{scale:.96,opacity:0}} animate={{scale:1,opacity:1}} exit={{scale:.96,opacity:0}} transition={{type:'spring', stiffness:260, damping:20}} className="w-full max-w-2xl rounded-2xl bg-white shadow-xl border">
              <div className="p-5 border-b"><div className="text-base font-semibold">{title}</div></div>
              <div className="p-5">{children}</div>
            </motion.div>
          </motion.div>
        </AnimatePresence>
      );
    }

    // æŒ‚è½½
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
